<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>GhostCat</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">
var game = new Phaser.Game(screen.width, screen.height, Phaser.CANVAS, 'ghost-kat', { preload: preload, create: create, update: update });

function preload () {

    game.load.image('ghostkat', 'assets/img/ghostkatrough.png');
    game.load.image('star', 'assets/img/star.png');
    game.load.image('sphere', 'assets/img/Sphere.png');
    game.load.image('heart', 'assets/img/heart.gif');

}

var stars;
var spheres;
var lovebeams;
var lovebeamTime=0;
var ghostkat;
var cursors;
var fireButton;
var frameTime = 0;
var frames;
var prevCamX = 0;

function create () {

    game.world.setBounds(0, 0, screen.width*10, screen.height);

    frames = Phaser.Animation.generateFrameNames('frame', 2, 30, '', 2);
    frames.unshift('frame02');

    stars = game.add.group();

    for (var i = 0; i < 1800; i++)
    {
        stars.create(game.world.randomX, game.world.randomY, 'star');
    }

    spheres = game.add.group();

    for (var i = 0; i < 1; i++)
    {
        spheres.create(game.world.randomX, game.world.randomY, 'sphere');
    }

    lovebeams = game.add.group();
    lovebeams.enableBody = true;
    lovebeams.physicsBodyType = Phaser.Physics.ARCADE;
    lovebeams.createMultiple(30, 'heart');
    lovebeams.setAll('anchor.x', 0.5);
    lovebeams.setAll('anchor.y', 1);
    lovebeams.setAll('outOfBoundsKill', true);
    lovebeams.setAll('checkWorldBounds', true);

    ghostkat = game.add.sprite(100, 300, 'ghostkat');
    ghostkat.anchor.x = 0.5;

    game.camera.follow(ghostkat, Phaser.Camera.FOLLOW_LOCKON, 0.1);

    cursors = game.input.keyboard.createCursorKeys();
    fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);

    prevCamX = game.camera.x;

}

function update () {

    if (cursors.left.isDown)
    {
        ghostkat.x -= 4;
        ghostkat.scale.x = -1;
    }
    else if (cursors.right.isDown)
    {
        ghostkat.x += 4;
        ghostkat.scale.x = 1;
    }

    if (cursors.up.isDown)
    {
        ghostkat.y -= 4;
    }
    else if (cursors.down.isDown)
    {
        ghostkat.y += 4;
    }

    if (fireButton.isDown)
    {
        fireLoveBeam();
    }


    prevCamX = game.camera.x;
    game.physics.arcade.overlap(lovebeams, spheres, collisionHandler, null, this);
}

function collisionHandler (lovebeam, sphere) {

    //  When a bullet hits an alien we kill them both
    lovebeam.kill();

}

//  To avoid them being allowed to fire too fast we set a time limit
function fireLoveBeam(){
  if (game.time.now > lovebeamTime)
  {
      //  Grab the first bullet we can from the pool
      lovebeam = lovebeams.getFirstExists(false);

      if (lovebeam)
      {
          //  And fire it
          lovebeam.reset(ghostkat.x+100, ghostkat.y+70 );
          lovebeam.body.velocity.x = 256;
          lovebeamTime = game.time.now + 400;
      }
  }

}

</script>

</body>
</html>
